# Internal Server Errorのデバッグ手順

## Step 1: ターミナルのエラーメッセージを確認

**最も重要：開発サーバーのターミナルウィンドウを確認してください**

1. **開発サーバーが起動しているターミナルウィンドウを開く**
2. **エラーメッセージを探す**
   - 赤い文字で表示されているエラーメッセージ
   - 以下のようなメッセージが表示されている可能性があります：

### よくあるエラーメッセージ

#### 1. 環境変数のエラー
```
error - Supabase環境変数が設定されていません
```
または
```
Error: NEXT_PUBLIC_SUPABASE_URL is not defined
```

**解決方法**: `.env.local`ファイルが正しく作成され、値が入力されているか確認

---

#### 2. データベース接続エラー
```
Error: relation "schools" does not exist
```
または
```
Error: column "school_id" does not exist
```

**解決方法**: SupabaseでSQLが実行されていない可能性があります

---

#### 3. 構文エラー
```
SyntaxError: Unexpected token
```

**解決方法**: コードの構文エラー

---

#### 4. normalizeAnswersのエラー
```
TypeError: Cannot read property 'xxx' of undefined
```

**解決方法**: `normalizeAnswers`関数のエラー

---

## Step 2: .env.localファイルの確認

### ファイルが存在するか確認

1. VS Codeのエクスプローラーで`.env.local`ファイルが表示されているか確認
2. ファイルを開いて内容を確認

### 正しい形式か確認

`.env.local`ファイルは以下の形式である必要があります：

```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**確認ポイント**:
- ✅ 各行に`=`が含まれている
- ✅ `=`の後に値が入力されている（空ではない）
- ✅ 値の前後にスペースがない
- ✅ 引用符（`"`や`'`）で囲まれていない
- ✅ 改行が正しく入っている

---

## Step 3: 開発サーバーの再起動

環境変数を変更した後は、**必ず開発サーバーを再起動**する必要があります：

1. **開発サーバーを停止**
   - ターミナルで **Ctrl + C** を押す

2. **完全に停止するまで待つ**
   - ターミナルにプロンプト（`C:\Users\...>`）が表示されるまで待つ

3. **再度起動**
   ```cmd
   npm run dev
   ```

---

## Step 4: ブラウザのコンソールを確認

1. **ブラウザでF12キーを押す**（開発者ツールを開く）
2. **「Console」タブを開く**
3. **エラーメッセージを確認**

---

## Step 5: ネットワークタブで確認

1. **ブラウザでF12キーを押す**
2. **「Network」タブを開く**
3. **ページをリロード**
4. **エラーが発生しているリクエストをクリック**
5. **「Response」タブでエラーの詳細を確認**

---

## よくある問題と解決方法

### 問題1: 環境変数が読み込まれない

**原因**: 開発サーバーを再起動していない

**解決方法**: 開発サーバーを停止して再起動

---

### 問題2: .env.localファイルが見つからない

**原因**: ファイルがプロジェクトルートにない

**解決方法**: 
- VS Codeで`survey-app`フォルダを開いているか確認
- `.env.local`ファイルが`package.json`と同じフォルダにあるか確認

---

### 問題3: 環境変数の値が間違っている

**原因**: Supabaseからコピーした値が正しくない

**解決方法**:
- Supabaseダッシュボードで再度確認
- 値の前後にスペースが入っていないか確認
- 値が途中で切れていないか確認

---

## 次のステップ

ターミナルに表示されているエラーメッセージを教えてください。それに基づいて具体的な解決方法を提案します。




