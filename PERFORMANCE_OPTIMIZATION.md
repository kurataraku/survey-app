# パフォーマンス最適化（SEO実装後の修正）

## 問題
SEO実装後に読み込み速度が遅くなった。

## 原因
1. **layout.tsxでの重複クエリ**: `generateMetadata`と`layout`コンポーネントで同じSupabaseクエリを実行していた
2. **構造化データ生成時の追加クエリ**: 各ページのlayout.tsxで構造化データ生成のために追加のSupabaseクエリを実行していた
3. **サイトマップ生成時の大量データ取得**: 口コミ詳細ページを1000件取得していた

## 対策

### 1. layout.tsxでの構造化データ生成を削除
- `app/schools/[slug]/layout.tsx`
- `app/reviews/[id]/layout.tsx`
- `app/features/[slug]/layout.tsx`

これらのファイルで、構造化データ生成のために実行していたSupabaseクエリを削除しました。

### 2. generateMetadataの最適化
- 詳細なメタ情報生成のためのSupabaseクエリを削除
- 簡易版のメタ情報に変更（slugから推測）
- パフォーマンスを優先し、詳細なメタ情報は必要に応じてクライアント側で設定可能

### 3. サイトマップの最適化
- 口コミ詳細ページの取得件数を1000件から500件に削減
- `order('created_at', { ascending: false })`を追加して最新順に取得

## 変更ファイル

### 変更
- `app/schools/[slug]/layout.tsx` - 構造化データ生成と詳細メタ情報生成を削除
- `app/reviews/[id]/layout.tsx` - 構造化データ生成と詳細メタ情報生成を削除
- `app/features/[slug]/layout.tsx` - 構造化データ生成と詳細メタ情報生成を削除
- `app/sitemap.ts` - 口コミ詳細ページの取得件数を削減

## 影響

### SEOへの影響
- 構造化データ: ページレベルの構造化データは削除されましたが、サイト全体の構造化データ（Organization、WebSite）は維持されています
- メタ情報: 簡易版に変更されましたが、基本的なSEO情報（タイトル、説明、キーワード）は維持されています

### パフォーマンスへの影響
- ページ読み込み時のSupabaseクエリが削減され、読み込み速度が改善されます
- 特に動的ページ（学校詳細、口コミ詳細、特集記事詳細）の読み込み速度が大幅に改善されます

## 今後の改善案

1. **構造化データのクライアント側生成**: 必要に応じて、クライアント側で構造化データを生成するコンポーネントを追加
2. **メタ情報のキャッシュ**: メタ情報生成結果をキャッシュして、同じページへのアクセス時のクエリを削減
3. **ISR（Incremental Static Regeneration）**: 静的ページの再生成を活用してパフォーマンスを向上
