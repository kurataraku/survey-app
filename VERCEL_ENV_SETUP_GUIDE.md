# Vercel環境変数設定ガイド（詳細版）

このガイドでは、`NEXT_PUBLIC_SITE_URL` 環境変数をVercelに設定する詳細な手順を説明します。

## 📍 ステップ1: デプロイされたサイトのURLを確認

### 方法A: Vercelダッシュボードから確認

1. **Vercelダッシュボードにアクセス**
   - https://vercel.com/dashboard にログイン

2. **プロジェクトを選択**
   - 左側のプロジェクト一覧から、デプロイしたプロジェクト（例: `survey-app`）をクリック

3. **デプロイメント一覧を確認**
   - 「**Deployments**」タブをクリック
   - 最新のデプロイメントを確認

4. **サイトのURLを確認**
   - 最新のデプロイメントの右側に「**Visit**」ボタンがあるはずです
   - そのボタンの横、またはデプロイメントカードの上部にURLが表示されています
   - 例: `https://survey-app-xxxxx.vercel.app`
   - または: `https://survey-app.vercel.app`（プロジェクト名がそのままURLになっている場合）

5. **URLをコピー**
   - URLを選択してコピー（Ctrl+C）
   - **重要**: `https://` から始まり、`.vercel.app` で終わる完全なURLをコピーしてください
   - 例: `https://survey-app-abc123.vercel.app`

### 方法B: ブラウザのアドレスバーから確認

1. デプロイされたサイトにアクセス
2. ブラウザのアドレスバーに表示されているURLをコピー
3. 例: `https://survey-app-abc123.vercel.app`

### 方法C: Vercelのプロジェクト設定から確認

1. プロジェクトの「**Settings**」タブをクリック
2. 「**General**」セクションを確認
3. 「**Domains**」または「**Deployment URL**」に表示されているURLを確認

---

## 📝 ステップ2: 環境変数を設定

### 環境変数設定画面への移動

1. **Vercelダッシュボードでプロジェクトを選択**
   - https://vercel.com/dashboard にログイン
   - 左側のプロジェクト一覧から、デプロイしたプロジェクトをクリック

2. **Settingsタブをクリック**
   - プロジェクトページの上部にある「**Settings**」タブをクリック

3. **Environment Variablesを選択**
   - 左側のメニューから「**Environment Variables**」をクリック
   - または、「Settings」ページ内で「**Environment Variables**」セクションを探す

### 新しい環境変数を追加

1. **「Add New」ボタンをクリック**
   - 「Environment Variables」ページの右上または下部に「**Add New**」ボタンがあるはずです
   - これをクリック

2. **Key（環境変数名）を入力**
   - 「**Key**」または「**Name**」というフィールドがあります
   - ここに、**正確に**以下のように入力してください:
     ```
     NEXT_PUBLIC_SITE_URL
     ```
   - **注意事項**:
     - 大文字と小文字を正確に入力してください
     - アンダースコア（_）を使用してください（ハイフンではありません）
     - 先頭や末尾に余分なスペースを入れないでください
     - コピー&ペーストする場合は、余分な文字が入っていないか確認してください

3. **Value（値）を入力**
   - 「**Value**」というフィールドがあります
   - ここに、ステップ1で確認したサイトのURLを入力してください
   - 例: `https://survey-app-abc123.vercel.app`
   - **注意事項**:
     - `https://` から始まる完全なURLを入力してください
     - URLの末尾に `/`（スラッシュ）は**付けないでください**
     - 余分なスペースを入れないでください

4. **Environment（環境）を選択**
   - 「**Environment**」または「**Environments**」というセクションがあります
   - 以下の3つすべてにチェックを入れてください:
     - ☑ **Production**（本番環境）
     - ☑ **Preview**（プレビュー環境）
     - ☑ **Development**（開発環境）
   - **重要**: すべての環境にチェックを入れることで、どの環境でもこの環境変数が使用されます

5. **「Save」または「Add」ボタンをクリック**
   - 入力内容を確認したら、「**Save**」または「**Add**」ボタンをクリック
   - 環境変数が追加されたことを確認してください

---

## 🔍 よくあるエラーと解決方法

### エラー1: "Key already exists"（キーが既に存在します）

**原因**: 同じ環境変数名が既に存在している

**解決方法**:
1. 環境変数一覧を確認
2. 既に `NEXT_PUBLIC_SITE_URL` が存在する場合は、それを編集してください
3. 既存の環境変数を削除してから新しく追加することもできます

### エラー2: "Invalid key format"（無効なキー形式）

**原因**: 環境変数名の形式が正しくない

**確認事項**:
- 大文字と小文字が正しいか（`NEXT_PUBLIC_SITE_URL`）
- アンダースコアが正しく入力されているか
- スペースが含まれていないか
- 特殊文字が含まれていないか

**解決方法**:
- キーを一度削除して、再度正確に入力してください

### エラー3: "Value cannot be empty"（値が空です）

**原因**: Valueフィールドが空、またはスペースのみが入力されている

**解決方法**:
- Valueフィールドに正しいURLを入力してください
- コピー&ペースト後、余分なスペースが入っていないか確認してください

### エラー4: 保存ボタンがクリックできない

**確認事項**:
1. Keyフィールドに値が入力されているか
2. Valueフィールドに値が入力されているか
3. Environment（環境）が少なくとも1つ選択されているか

**解決方法**:
- すべての必須フィールドを正しく入力してください

### エラー5: ビルド後も警告が表示される

**原因**: 環境変数を追加した後、再デプロイしていない

**解決方法**:
1. 環境変数を追加・変更した後は、必ず再デプロイが必要です
2. 「Deployments」タブを開く
3. 最新のデプロイメントの右側の「...」メニューをクリック
4. 「Redeploy」を選択
5. 「Redeploy」ボタンをクリック

---

## ✅ 設定確認方法

### 環境変数が正しく設定されているか確認

1. **Environment Variablesページで確認**
   - 「Environment Variables」ページに戻る
   - `NEXT_PUBLIC_SITE_URL` が一覧に表示されているか確認
   - Valueが正しいURLになっているか確認

2. **ビルドログで確認**
   - 再デプロイ後、ビルドログを確認
   - `⚠️ NEXT_PUBLIC_SITE_URLが設定されていません` という警告が表示されなくなったか確認

3. **実際のサイトで確認**
   - デプロイされたサイトにアクセス
   - `https://your-site.vercel.app/sitemap.xml` にアクセス
   - sitemap.xmlのURLが `https://example.com` ではなく、実際のサイトURLになっているか確認

---

## 📸 スクリーンショットで確認（参考）

### Environment Variablesページの見え方

```
┌─────────────────────────────────────────┐
│ Environment Variables                   │
├─────────────────────────────────────────┤
│ [Add New] ボタン                        │
│                                         │
│ ┌───────────────────────────────────┐ │
│ │ Key: NEXT_PUBLIC_SITE_URL         │ │
│ │ Value: https://survey-app-...     │ │
│ │ Environments: ☑ Production        │ │
│ │            ☑ Preview              │ │
│ │            ☑ Development          │ │
│ │ [Save] ボタン                     │ │
│ └───────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

---

## 🆘 それでも解決しない場合

1. **エラーメッセージの全文をコピー**
   - Vercelダッシュボードに表示されているエラーメッセージをそのままコピーしてください
   - ブラウザのコンソール（F12）にエラーが表示されている場合は、それもコピーしてください

2. **スクリーンショットを撮る**
   - 環境変数設定画面のスクリーンショットを撮ってください
   - エラーメッセージが表示されている部分を含めてください

3. **現在の設定を確認**
   - 既に設定されている環境変数の一覧を確認してください
   - `NEXT_PUBLIC_SITE_URL` が既に存在する場合は、その値を確認してください

---

## 📝 まとめ

- **Key**: `NEXT_PUBLIC_SITE_URL`（大文字小文字を正確に）
- **Value**: デプロイされたサイトのURL（例: `https://survey-app-abc123.vercel.app`）
- **Environment**: Production、Preview、Developmentすべてにチェック
- **重要**: 環境変数を追加・変更した後は、必ず再デプロイが必要

これで、`NEXT_PUBLIC_SITE_URL` 環境変数を正しく設定できます！
